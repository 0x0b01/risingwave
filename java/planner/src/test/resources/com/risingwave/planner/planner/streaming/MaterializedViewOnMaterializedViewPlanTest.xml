<Root>
    <TestCase name="query 1">
        <Resource name="sql">
            <![CDATA[
create materialized view M1 as select v1, v2 from t where v1 = 1;
            ]]>
        </Resource>
        <Resource name="plan">
            <![CDATA[
RwStreamMaterializedView(name=[m1])
  RwStreamFilter(condition=[=($0, 1)])
    RwStreamTableSource(table=[[test_schema, t]], columns=[v1,v2,_row_id])
]]>
        </Resource>
        <Resource name="json" path="streaming/materialized_view_on_materialized_view_plan_test/q1">
        </Resource>>
        <Resource name="primaryKey">
            <![CDATA[
[2]
            ]]>
        </Resource>
    </TestCase>

    <TestCase name="query 2">
        <Resource name="sql">
            <![CDATA[
create materialized view M2 as select v1, v2 from t where v2 = 1;
            ]]>
        </Resource>
        <Resource name="plan">
            <![CDATA[
RwStreamMaterializedView(name=[m2])
  RwStreamFilter(condition=[=($1, 1)])
    RwStreamTableSource(table=[[test_schema, t]], columns=[v1,v2,_row_id])
]]>
        </Resource>
        <Resource name="json" path="streaming/materialized_view_on_materialized_view_plan_test/q2">
        </Resource>>
        <Resource name="primaryKey">
            <![CDATA[
[2]
            ]]>
        </Resource>
    </TestCase>

    <TestCase name="query 3">
        <Resource name="sql">
            <![CDATA[
create materialized view M3 as select sum(M1.v1) as sum_m1_v1, sum(M1.v2) as sum_m1_v2 from M1;
            ]]>
        </Resource>
        <Resource name="plan">
            <![CDATA[
RwStreamMaterializedView(name=[m3])
  RwStreamProject(sum_m1_v1=[$STREAM_NULL_BY_ROW_COUNT($0, $1)], sum_m1_v2=[$STREAM_NULL_BY_ROW_COUNT($0, $2)], $f0=[$0], sum_m1_v1_copy=[$1], sum_m1_v2_copy=[$2])
    RwStreamAgg(group=[{}], agg#0=[COUNT()], sum_m1_v1=[SUM($0)], sum_m1_v2=[SUM($1)])
      RwStreamChain(table=[[test_schema, m1]], tableId=[0.0.1])
]]>
        </Resource>
        <Resource name="json" path="streaming/materialized_view_on_materialized_view_plan_test/q3">
        </Resource>>
        <Resource name="primaryKey">
            <![CDATA[
[2, 3, 4]
            ]]>
        </Resource>
    </TestCase>

    <TestCase name="query 4">
        <Resource name="sql">
            <![CDATA[
create materialized view M4 as select M1.v1 as m1v1, M1.v2 as m1v2, M2.v1 as m2v1, M2.v2 as m2v2 from M1 join M2 on M1.v1 = M2.v1;
            ]]>
        </Resource>
        <Resource name="plan">
            <![CDATA[
RwStreamMaterializedView(name=[m4])
  RwStreamHashJoin(condition=[=($0, $3)], joinType=[inner])
    RwStreamExchange(distribution=[RwDistributionTrait{type=HASH_DISTRIBUTED, keys=[0]}], collation=[[]])
      RwStreamChain(table=[[test_schema, m1]], tableId=[0.0.1])
    RwStreamExchange(distribution=[RwDistributionTrait{type=HASH_DISTRIBUTED, keys=[0]}], collation=[[]])
      RwStreamChain(table=[[test_schema, m2]], tableId=[0.0.2])
]]>
        </Resource>
        <Resource name="json" path="streaming/materialized_view_on_materialized_view_plan_test/q4">
        </Resource>>
        <Resource name="primaryKey">
            <![CDATA[
[2, 5]
            ]]>
        </Resource>
    </TestCase>
</Root>
