statement ok
create table t(v1 int not null, v2 int not null);

statement ok
create materialized view M1 as select v1, v2 from t where v1 = 1;

statement ok
create materialized view M2 as select v1, v2 from t where v2 = 1;

statement ok
create materialized view M3 as select sum(M1.v1) as sum_m1_v1, sum(M1.v2) as sum_m1_v2 from M1;

statement ok
create materialized view M4 as select M1.v1 as m1v1, M1.v2 as m1v2, M2.v1 as m2v1, M2.v2 as m2v2 from M1 join M2 on M1.v1 = M2.v1;

sleep 1s

statement ok
insert into t values (2,1),(1,2),(1,1);

sleep 1s

query II
select * from t;
----
2 1
1 2
1 1

query III
select * from M1;
----
1 2 1
1 1 2

query III
select * from M2;
----
2 1 0
1 1 2

query IIIII
select * from M3;
----
2 3 2 2 3

query IIIIII
select * from M4;
----
1 2 1 1 1 2
1 1 2 1 1 2

statement ok
create materialized view M5 as select M1.v1 as m1v1, M1.v2 as m1v2, M2.v1 as m2v1, M2.v2 as m2v2 from M1 join M2 on M1.v1 = M2.v1;

sleep 1s

query IIIIII
select * from M5;
----
1 2 1 1 1 2
1 1 2 1 1 2

statement ok
insert into t values (3,1),(1,3);

sleep 1s

query IIIIII
select * from M5;
----
1 2 1 1 1 2
1 1 2 1 1 2
1 3 4 1 1 2
